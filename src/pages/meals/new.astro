---
import Layout from '../../layouts/Layout.astro';
import { protectRoute } from '../../utils/auth/protect-route';
import MealForm from '../../features/registro-comida/components/MealForm-v2';

// Proteger ruta - redirigir a login si no está autenticado
const result = await protectRoute(Astro);

// Si es una redirección, la función ya se encargó de redirigir
if (result instanceof Response) {
  return result;
}

// Si llegamos aquí, el usuario está autenticado
const { user } = result;
---

<Layout title="Nueva Comida | Food Diary">
  <div class="max-w-4xl mx-auto px-4 py-8">
    <div class="mb-6">
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Registrar Nueva Comida</h1>
      <p class="text-gray-600 dark:text-gray-400 mt-1">
        Registra los platos que has consumido y analiza sus valores nutricionales.
      </p>
    </div>
    
    <div class="bg-white dark:bg-gray-800 shadow-md rounded-lg p-6">
      <MealForm client:load />
    </div>
  </div>
</Layout>

<script>
  // Código de cliente para manejar la navegación, si es necesario
</script>